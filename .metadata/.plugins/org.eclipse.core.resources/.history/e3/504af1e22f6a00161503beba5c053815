package change;

import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

import org.eclipse.emf.common.notify.Notification;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.EReference;

import impl.CBPResource;

public abstract class EReferenceEvent extends Event
{
	private NotifierType notifierType;
	
	private List<EObject> eObjectList = new ArrayList<EObject>();
	
	private EObject focusObject;
	
	private EReference eref;
	
    @SuppressWarnings("unchecked")
	public EReferenceEvent(EObject focusObject,EObject value,EReference eref, NotifierType notifierType)
    {
        super(Event.EREFERENCE_EVENT);
        
        this.focusObject = focusObject;
        
        if(value instanceof Collection)
        	this.eObjectList = (List<EObject>) value;
        
        else
        	this.eObjectList.add((EObject) value);
        
        this.notifierType = notifierType;
        
        this.eref = eref;  
    }
    
    
    @SuppressWarnings("unchecked")
    public EReferenceEvent(Notification n,EReferenceEventType eReferenceEventType )
    {
    	
        super(Event.EREFERENCE_EVENT);
        
        Object newValue = n.getNewValue();
        
        if(eReferenceEventType == EReferenceEventType.UNSET)
        	newValue = n.getOldValue();
        
        
        if(newValue instanceof Collection)
        	this.obj_list = (List<EObject>) newValue;
        
        else
        	this.obj_list.add((EObject) newValue);
        
         if(n.getNotifier() instanceof CBPResource)
         {
             this.notifierType = NotifierType.RESOURCE;
         }
         else if(n.getNotifier() instanceof EObject)
         {
             this.notifierType = NotifierType.EOBJECT;
        
             this.focus_obj = (EObject) n.getNotifier();
             
             this.eref = (EReference) n.getFeature();
         }
         
         this.eReferenceEventType = eReferenceEventType;
    }
    
    public NotifierType getNotifierType()
    {
        return this.notifierType;
    }
    
    public EObject getFocusObj()
    {
        return focus_obj;
    }
    
    public List<EObject> getEObjectList()
    {
        return this.obj_list;
    }
    
    public EReference getEReference()
    {
        return this.eref;
    }
    
    public EReferenceEventType getEReferenceEventType()
    {
    	return this.eReferenceEventType;
    }
}

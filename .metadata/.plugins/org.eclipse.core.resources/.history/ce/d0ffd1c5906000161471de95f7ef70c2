package change;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.UUID;

import org.eclipse.emf.common.notify.Notification;
import org.eclipse.emf.ecore.EObject;

import com.google.common.collect.BiMap;
import com.google.common.collect.HashBiMap;

import impl.DeltaResourceImpl;
import util.KDebug;


public class ChangeLog 
{
	private final List<Notification> notificationsList;
	private final BiMap<EObject,Double> map; 
	private final String classname = this.getClass().getSimpleName();
	
	/* needs to be static so we can track the latest (highest) available 
	 * id globally across instantiations of this changelog. A new changelog is instantiated 
	 * at save and at load. if this var is not static, current id reverts to 0*/
	private static double current_id; 
	
	public ChangeLog()
	{
		notificationsList = new ArrayList<Notification>();
		map = HashBiMap.create();
		current_id = 0.0;
		//check this
	}
	
	public BiMap<EObject,Double> getObjectToIdMap()
	{
		return map;
	}
	
	public boolean addObjectToMap(EObject obj)
	{
		//System.out.println(obj.eClass().getName());
		if(map.get(obj)== null)
		{
			System.out.println(classname+"adding object to map via addObjectToMap(obj)");
			System.out.println(classname+" current id before is "+current_id);
			map.put(obj, current_id);
			current_id = current_id + 1; //update
			
			System.out.println(classname+" id updated, new value: "+current_id);
			return true;
		}	
		return false;
	}
	
	public boolean deleteEObjectFromMap(double id)
	{
		map.remove(500);
		return true;
	}
	
	// cid = 5, id =5
	public boolean addObjectToMap(EObject obj, double id)
	{
		if(id >= current_id)
		{
			System.out.println(classname+"adding object to map via addObjectToMap(obj,id)");
			System.out.println(classname+" current id before is "+current_id);
			current_id = id + 1;
			System.out.println(classname+" id updated in addObjectToMap(obj ,id) : "+current_id);
			
		}
			
		 
		if(getEObject(id) == null)
		{
			map.put(obj, id);
			return true;
		}	
		return false;
	}
	
	public double getObjectId(EObject obj)
	{
		double id;
		if(map.get(obj)!= null)
			id = map.get(obj);
		else
			id = -1;
		
		return id;
	}
	
	public EObject getEObject(double id)
	{
		return  map.inverse().get(id);
	}
	
	public void addNotification(Notification n)
	{
		notificationsList.add(n);
	}
	
	public List<Notification> getEventsList()
	{
		return notificationsList;
	}
	
	
}
